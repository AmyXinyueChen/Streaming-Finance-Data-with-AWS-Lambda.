# Streaming-Finance-Data-with-AWS-Lambda

This project leads you through the process of consuming “real time” data, processing the data and then dumping it in a manner that facilitates querying and further analysis, either in real time or near real time capacity.

![image](https://user-images.githubusercontent.com/74834219/118514305-783ccc00-b702-11eb-8a20-b25abb5227a9.png)

## DataTransformer
Setting up the lambda function :

```
import json
import boto3
import yfinance as yf 

kinesis = boto3.client('kinesis', "us-east-2")

def lambda_handler(event, context):
    tickerlst=["FB","SHOP","BYND","NFLX","PINS","SQ","TTD","OKTA","SNAP","DDOG"]
    
    for ticker in tickerlst:
        
        stock = yf.download(ticker, start="2021-05-11", end="2021-05-12",interval="5m")
        stock.reset_index(inplace=True)
        for index, row in stock.iterrows():
            
            data = {}
            data["high"]=row["High"]
            data["low"]=row["Low"]
            data["ts"]=row["Datetime"].isoformat()
            data["name"]=ticker
            data=json.dumps(data)+"\n"
            print(data)
            kinesis.put_record(
            StreamName="your_own_kinesis_stream_name",
            Data=data,
            PartitionKey="partitionkey")    
    return {
        'statusCode': 200,
        'body': json.dumps('Hello fromf Lambda!')
    }
```



## DataCollector
Setting up Kinesis stream and place stock price data  into the delivery
![kinesis_config](https://user-images.githubusercontent.com/74834219/118516602-74aa4480-b704-11eb-98c5-ca98c61525ef.png)

## DataAnalyzer
configure AWS Glue,pointing it to the S3 Bucket in the DataCollector. This will allow us to now interactively query the S3 files generated by the DataTransformer using AWS Athena to gain insight into our streamed data. 
```
SELECT B.name, B.Hour, A.ts,B.HOUR_HIGHEST
FROM your_table_name A
INNER JOIN

(SELECT name, SUBSTRING(ts,12,2) as Hour, MAX(high) AS HOUR_HIGHEST
FROM sta9760s2021_project03_s3 
GROUP BY name,SUBSTRING(ts,12,2)) B

ON A.name=B.name and A.high=B.HOUR_HIGHEST
ORDER BY B.name, B.Hour
```
